{% extends "cds_brochure_unique_form.html" %} {% load i18n %} {% load static %}
{% block title %}{% endblock title %} {% block form_container %}
<div class="card-wrapper card-space">
  <div class="card card-bg no-after">
    <div class="card-body mt-4">
      <h3 style="font-weight: normal" class="mb-4 pb-4">
        {% blocktrans %}Scheda Master{% endblocktrans %}
      </h3>

      <!-- MESSAGGI -->
      {% if messages %}
      <div class="mb-3">
        {% for message in messages %}
        <div
          class="alert alert-{{ message.tags }} alert-dismissible fade show"
          role="alert"
        >
          {{ message|safe }}
          <button
            type="button"
            class="close"
            data-dismiss="alert"
            aria-label="Close"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <!-- NAV TABS -->
      <ul class="nav nav-tabs nav-justified" id="master-tabs" role="tablist">
        {% for tab, form in forms.items %} {% with trimmed_tab=tab|cut:" " %}
        <li class="nav-item">
          <a
            class="nav-link {% if forloop.first and not last_viewed_tab or last_viewed_tab == tab %}active{% endif %}"
            id="{{trimmed_tab}}-nav-item"
            data-toggle="tab"
            href="#{{trimmed_tab}}-tab"
            role="tab"
            aria-controls="{{trimmed_tab}}-tab"
            aria-selected="{% if forloop.first %}true{% else %}false{% endif %}"
          >
            {{tab}}
          </a>
        </li>
        {% endwith %} {% endfor %}
      </ul>

      <!-- TAB CONTENT -->
      <div class="tab-content pt-2" id="master-tabsContent">
        {% for tab, form in forms.items %} {% with trimmed_tab=tab|cut:" " %}
        <div
          class="tab-pane p-4 mt-3 fade {% if forloop.first and not last_viewed_tab or last_viewed_tab == tab %}show active{% endif %}"
          id="{{trimmed_tab}}-tab"
          role="tabpanel"
          aria-labelledby="{{trimmed_tab}}-nav-item"
        >
          <form method="post" enctype="multipart/form-data" novalidate>
            {% csrf_token %} {% if form.management_form %} {{
            form.management_form }} {% if tab == "Incarichi Didattici" %}
            <table class="table table-striped table-bordered">
              <thead>
                <tr>
                  <th>Modulo</th>
                  <th>Numero ore</th>
                  <th>Docente</th>
                  <th>Qualifica</th>
                  <th>Ente</th>
                  <th>Tipologia</th>
                  <th>Elimina</th>
                </tr>
              </thead>
              <tbody>
                {% for f in form %}
                <tr>
                  <td>{{ f.modulo }}</td>
                  <td>{{ f.num_ore }}</td>
                  <td>{{ f.docente }}</td>
                  <td>{{ f.qualifica }}</td>
                  <td>{{ f.ente }}</td>
                  <td>{{ f.tipologia }}</td>
                  <td>{{ f.DELETE }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
            {% elif tab == "Piano Didattico" %}
            <table class="table table-striped table-bordered">
              <thead>
                <tr>
                  <th>Modulo</th>
                  <th>SSD</th>
                  <th>Numero ore</th>
                  <th>CFU</th>
                  <th>Verifica finale</th>
                  <th>Elimina</th>
                </tr>
              </thead>
              <tbody>
                {% for f in form %}
                <tr>
                  <td>{{ f.modulo }}</td>
                  <td>{{ f.ssd }}</td>
                  <td>{{ f.num_ore }}</td>
                  <td>{{ f.cfu }}</td>
                  <td>{{ f.verifica_finale }}</td>
                  <td>{{ f.DELETE }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
            {% endif %} {% else %} {# Caso ModelForm singolo (Dati generali) #}
            {% include "form_template.html" with form=form %} {% endif %}

            <input type="hidden" name="tab_form_dict_key" value="{{tab}}" />

            <div class="mt-3 text-right">
              <button type="submit" class="btn btn-primary">
                Salva {{ tab }}
              </button>
            </div>
          </form>
        </div>
        {% endwith %} {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endblock form_container %}
