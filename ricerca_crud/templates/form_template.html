{% load i18n %}
{% load ricerca_crud %}
{% load static %}

{% random_id uid as id %}

<div id="{{ id }}">
    {% for field in form %}
        {% if field.field.widget.input_type != 'hidden' %}
        <div style="padding: 0 0 1rem">
            <b>{{ field.label_tag }}</b>
            {% if field.field.required %}*{% endif %}
        {% endif %}
        {% if not field.field.api %}
            {{ field }}
        {% else %}
            <select name="{{ field.name }}" id="id_{{ field.name }}" @change="callAPI('{{ field.field.api }}')">
                <option value="">...</option>
                <option value="1">..1.</option>
                <option :value="item.TeacherID" v-for="item in items">
                    [[ item.TeacherName ]]
                </option>
            </select>
        {% endif %}
        {% if field.help_text %}
            <small class="form-text text-muted">
                {{ field.help_text|safe }}
            </small>
        {% endif %}
        {% if field.errors and field.field.widget.input_type != 'hidden' %}
            <small class="text-danger">
                {{ field.errors }}
            </small>
        {% endif %}

        {% if field.field.widget.input_type != 'hidden' %}
        </div>
        {% endif %}
    {% endfor %}
    {% csrf_token %}

</div>
<script>
var {{ id }} = new Vue({
    el: '[id="{{ id }}"]',
    data() {
        return {
            items: [],
            next_page: "",
            previous_page: "",
            is_loading: true,
        }
    },
    methods: {
        callAPI(url, initial=false) {
            axios
                .get(url)
                .then(response => {
                    this.items = response.data.results;
                    this.next_page = response.data.next;
                    this.previous_page = response.data.previous;
                })
        },
    }
})
</script>
{{ form.media }}
